montageDefine("78f4f03","listen/property-changes",{dependencies:["../shim","../weak-map"],factory:function(e,t,n){function s(){throw Error("This is an abstract interface. Mix it. Don't construct it")}e("../shim");var a=e("../weak-map"),i=Object.prototype.hasOwnProperty,r=new a,o=new a;n.exports=s,s.debug=!0,s.prototype.getOwnPropertyChangeDescriptor=function(e){r.has(this)||r.set(this,{});var t=r.get(this);return i.call(t,e)||(t[e]={willChangeListeners:[],changeListeners:[]}),t[e]},s.prototype.hasOwnPropertyChangeDescriptor=function(e){if(!r.has(this))return!1;if(!e)return!0;var t=r.get(this);return i.call(t,e)?!0:!1},s.prototype.addOwnPropertyChangeListener=function(e,t,n){this.makeObservable&&!this.isObservable&&this.makeObservable();var a,i=s.getOwnPropertyChangeDescriptor(this,e);a=n?i.willChangeListeners:i.changeListeners,s.makePropertyObservable(this,e),a.push(t);var r=this;return function(){s.removeOwnPropertyChangeListener(r,e,a,n),r=null}},s.prototype.addBeforeOwnPropertyChangeListener=function(e,t){return s.addOwnPropertyChangeListener(this,e,t,!0)},s.prototype.removeOwnPropertyChangeListener=function(e,t,n){var a,i=s.getOwnPropertyChangeDescriptor(this,e);a=n?i.willChangeListeners:i.changeListeners;var r=a.lastIndexOf(t);if(-1===r)throw Error("Can't remove listener: does not exist.");a.splice(r,1),0===i.changeListeners.length+i.willChangeListeners.length&&s.makePropertyUnobservable(this,e)},s.prototype.removeBeforeOwnPropertyChangeListener=function(e,t){return s.removeOwnPropertyChangeListener(this,e,t,!0)},s.prototype.dispatchOwnPropertyChange=function(e,t,n){var a=s.getOwnPropertyChangeDescriptor(this,e);if(!a.isActive){a.isActive=!0;var i;i=n?a.willChangeListeners:a.changeListeners;var r=(n?"Will":"")+"Change",o="handleProperty"+r,l=e+"";l=l&&l[0].toUpperCase()+l.slice(1);var c="handle"+l+r;try{i.forEach(function(n){var s=n;n=n[c]||n[o]||n,n.call(s,t,e,this)},this)}finally{a.isActive=!1}}},s.prototype.dispatchBeforeOwnPropertyChange=function(e,t){return s.dispatchOwnPropertyChange(this,e,t,!0)},s.prototype.makePropertyObservable=function(e){if(!Array.isArray(this)){if(!Object.isExtensible(this,e))throw Error("Can't make property "+JSON.stringify(e)+" observable on "+this+" because object is not extensible");var t;"object"==typeof this.__state__?t=this.__state__:(t={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:t,writable:!0,enumerable:!1})),t[e]=this[e],o.has(this)||(n={},o.set(this,n));var n=o.get(this);if(!i.call(n,e)){var a,r=this;Object.getOwnPropertyDescriptor(r,e);do{if(a=Object.getOwnPropertyDescriptor(r,e))break;r=Object.getPrototypeOf(r)}while(r);if(a=a||{value:void 0,enumerable:!0,writable:!0,configurable:!0},!a.configurable)throw Error("Can't observe non-configurable properties");if(n[e]=a,a.writable||a.set){var l;l="value"in a?{get:function(){return a.value},set:function(n){return n===a.value?n:(s.dispatchBeforeOwnPropertyChange(this,e,a.value),a.value=n,t[e]=n,s.dispatchOwnPropertyChange(this,e,n),n)},enumerable:a.enumerable,configurable:!0}:{get:function(){return a.get?a.get.apply(this,arguments):void 0},set:function(n){var i;return a.get&&(i=a.get.apply(this,arguments)),a.set&&a.set.apply(this,arguments),a.get&&(n=a.get.apply(this,arguments),t[e]=n),n===i?n:(s.dispatchBeforeOwnPropertyChange(this,e,i),s.dispatchOwnPropertyChange(this,e,n),n)},enumerable:a.enumerable,configurable:!0},Object.defineProperty(this,e,l)}}}},s.prototype.makePropertyUnobservable=function(e){if(!Array.isArray(this)){if(!o.has(this))throw Error("Can't uninstall observer on property");var t=o.get(this);if(!t[e])throw Error("Can't uninstall observer on property");var n=t[e];delete t[e];var s;"object"==typeof this.__state__?s=this.__state__:(s={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:s,writable:!0,enumerable:!1})),delete s[e],Object.defineProperty(this,e,n)}},s.getOwnPropertyChangeDescriptor=function(e,t){return e.getOwnPropertyChangeDescriptor?e.getOwnPropertyChangeDescriptor(t):s.prototype.getOwnPropertyChangeDescriptor.call(e,t)},s.hasOwnPropertyChangeDescriptor=function(e,t){return e.hasOwnPropertyChangeDescriptor?e.hasOwnPropertyChangeDescriptor(t):s.prototype.hasOwnPropertyChangeDescriptor.call(e,t)},s.addOwnPropertyChangeListener=function(e,t,n,a){return Object.isObject(e)?e.addOwnPropertyChangeListener?e.addOwnPropertyChangeListener(t,n,a):s.prototype.addOwnPropertyChangeListener.call(e,t,n,a):void 0},s.removeOwnPropertyChangeListener=function(e,t,n,a){return Object.isObject(e)?e.removeOwnPropertyChangeListener?e.removeOwnPropertyChangeListener(t,n,a):s.prototype.removeOwnPropertyChangeListener.call(e,t,n,a):void 0},s.dispatchOwnPropertyChange=function(e,t,n,a){return Object.isObject(e)?e.dispatchOwnPropertyChange?e.dispatchOwnPropertyChange(t,n,a):s.prototype.dispatchOwnPropertyChange.call(e,t,n,a):void 0},s.addBeforeOwnPropertyChangeListener=function(e,t,n){return s.addOwnPropertyChangeListener(e,t,n,!0)},s.removeBeforeOwnPropertyChangeListener=function(e,t,n){return s.removeOwnPropertyChangeListener(e,t,n,!0)},s.dispatchBeforeOwnPropertyChange=function(e,t,n){return s.dispatchOwnPropertyChange(e,t,n,!0)},s.makePropertyObservable=function(e,t){return e.makePropertyObservable?e.makePropertyObservable(t):s.prototype.makePropertyObservable.call(e,t)},s.makePropertyUnobservable=function(e,t){return e.makePropertyUnobservable?e.makePropertyUnobservable(t):s.prototype.makePropertyUnobservable.call(e,t)}}});