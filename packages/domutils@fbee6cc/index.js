function find(e,t,n,a){for(var s,r=[],i=0,o=t.length;o>i&&!(e(t[i])&&(r.push(t[i]),0>=--a))&&(s=t[i].children,!(n&&s&&s.length>0&&(s=find(e,s,n,a),r=r.concat(s),a-=s.length,0>=a)));i++);return r}function findOne(e,t,n){for(var a=0,s=t.length;s>a;a++){if(e(t[a]))return t[a];if(n&&t[a].children&&t[a].children.length>0){var r=findOne(e,t[a].children,!0);if(r)return r}}return null}function findAll(e,t){return t.reduce(function(t,n){return n.children&&n.children.length>0?t.concat(findAll(e,n.children)):t},t.filter(e))}function filter(e,t,n,a){return Array.isArray(t)||(t=[t]),"number"==typeof a&&isFinite(a)?1===a?(t=findOne(e,t,n!==!1),t?[t]:[]):find(e,t,n!==!1,a):n===!1?t.filter(e):findAll(e,t)}function getAttribCheck(e,t){return"function"==typeof t?function(n){return n.attribs&&t(n.attribs[e])}:function(n){return n.attribs&&n.attribs[e]===t}}var ElementType=require("domelementtype"),DomUtils=module.exports,isTag=DomUtils.isTag=ElementType.isTag;DomUtils.filter=filter,DomUtils.testElement=function(e,t){for(var n in e)if(e.hasOwnProperty(n)){if("tag_name"===n){if(!isTag(t)||!e.tag_name(t.name))return!1}else if("tag_type"===n){if(!e.tag_type(t.type))return!1}else if("tag_contains"===n){if(isTag(t)||!e.tag_contains(t.data))return!1}else if(!t.attribs||!e[n](t.attribs[n]))return!1}else;return!0};var Checks={tag_name:function(e){return"function"==typeof e?function(t){return isTag(t)&&e(t.name)}:"*"===e?isTag:function(t){return isTag(t)&&t.name===e}},tag_type:function(e){return"function"==typeof e?function(t){return e(t.type)}:function(t){return t.type===e}},tag_contains:function(e){return"function"==typeof type?function(t){return!isTag(t)&&e(t.data)}:function(t){return!isTag(t)&&t.data===e}}};DomUtils.getElements=function(e,t,n,a){var s=[];for(var r in e)e.hasOwnProperty(r)&&(r in Checks?s.push(Checks[r](e[r])):s.push(getAttribCheck(r,e[r])));return 0===s.length?[]:1===s.length?filter(s[0],t,n,a):filter(function(e){return s.some(function(t){return t(e)})},t,n,a)},DomUtils.getElementById=function(e,t,n){return Array.isArray(t)||(t=[t]),findOne(getAttribCheck("id",e),t,n!==!1)},DomUtils.getElementsByTagName=function(e,t,n,a){return filter(Checks.tag_name(e),t,n,a)},DomUtils.getElementsByTagType=function(e,t,n,a){return filter(Checks.tag_type(e),t,n,a)},DomUtils.removeElement=function(e){e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent&&e.parent.children.splice(e.parent.children.lastIndexOf(e),1)},DomUtils.getInnerHTML=function(e){if(!e.children)return"";for(var t=e.children,n=t.length,a="",s=0;n>s;s++)a+=DomUtils.getOuterHTML(t[s]);return a};var booleanAttribs={__proto__:null,async:!0,autofocus:!0,autoplay:!0,checked:!0,controls:!0,defer:!0,disabled:!0,hidden:!0,loop:!0,multiple:!0,open:!0,readonly:!0,required:!0,scoped:!0,selected:!0,"/":!0},emptyTags={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,link:!0,meta:!0,param:!0,embed:!0};DomUtils.getOuterHTML=function(e){var t=e.type;if(t===ElementType.Text)return e.data;if(t===ElementType.Comment)return"<!--"+e.data+"-->";if(t===ElementType.Directive)return"<"+e.data+">";if(t===ElementType.CDATA)return"<!CDATA "+DomUtils.getInnerHTML(e)+"]]>";var n="<"+e.name;if("attribs"in e)for(var a in e.attribs)if(e.attribs.hasOwnProperty(a)){n+=" "+a;var s=e.attribs[a];s?n+='="'+s+'"':a in booleanAttribs||(n+='=""')}return e.name in emptyTags&&0===e.children.length?n+" />":n+">"+DomUtils.getInnerHTML(e)+"</"+e.name+">"},DomUtils.getText=function getText(e){return Array.isArray(e)?e.map(getText).join(""):isTag(e)||e.type===ElementType.CDATA?getText(e.children):e.type===ElementType.Text?e.data:""};