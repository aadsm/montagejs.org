function compile(e){return compile.semantics.compile(e)}var compileEvaluator=require("./compile-evaluator"),solve=require("./algebra"),Scope=require("./scope"),valueSyntax={type:"value"},trueScope={type:"literal",value:!0},falseScope={type:"literal",value:!1};module.exports=compile,compile.semantics={compile:function(e){var t=this.compilers;if("equals"===e.type){var n=this.compile(e.args[0]),a=this.compileEvaluator(e.args[1]);return t.equals(n,a)}if("if"===e.type){var s=this.compileEvaluator(e.args[0]),r=this.compile(e.args[1]),i=this.compile(e.args[2]);return t["if"](s,r,i)}if("and"===e.type||"or"===e.type){var o=solve(e.args[0],valueSyntax),l=solve(e.args[1],valueSyntax),c=this.compileEvaluator(e.args[0]),a=this.compileEvaluator(e.args[1]),p=this.compileEvaluator(o[1]),u=this.compileEvaluator(l[1]),n=this.compile(o[0]),h=this.compile(l[0]);return t[e.type](n,h,c,a,p,u)}if("everyBlock"===e.type){var d=this.compileEvaluator(e.args[0]),m=solve(e.args[1],{type:"literal",value:!0}),g=this.compile(m[0]),f=this.compileEvaluator(m[1]);return t.everyBlock(d,g,f)}if(t.hasOwnProperty(e.type)){var v=e.args.map(this.compileEvaluator,this.compileEvaluator.semantics);return t[e.type].apply(null,v)}throw Error("Can't compile assigner for "+JSON.stringify(e.type))},compileEvaluator:compileEvaluator,compilers:{property:function(e,t){return function(n,a){var s=e(a);if(s){var r=t(a);null!=r&&(Array.isArray(s)?s.set(r,n):s[r]=n)}}},get:function(e,t){return function(n,a){var s=e(a);if(s){var r=t(a);null!=r&&s.set(r,n)}}},has:function(e,t){return function(n,a){var s=e(a);if(s){var r=t(a);null!=n&&(n?(s.has||s.contains).call(s,r)||s.add(r):(s.has||s.contains).call(s,r)&&(s.remove||s["delete"]).call(s,r))}}},equals:function(e,t){return function(n,a){return n?e(t(a),a):void 0}},"if":function(e,t,n){return function(a,s){var r=e(s);if(null!=r)return r?t(a,s):n(a,s)}},and:function(e,t,n,a,s,r){return function(i,o){null!=i&&(i?(e(s(trueScope),o),t(r(trueScope),o)):e(n(o)&&!a(o),o))}},or:function(e,t,n,a,s,r){return function(i,o){null!=i&&(i?e(n(o)||!a(o),o):(e(s(falseScope),o),t(r(falseScope),o)))}},rangeContent:function(e){return function(t,n){var a=e(n);a&&(t?a.swap(0,a.length,t):a.clear())}},mapContent:function(e){return function(t,n){var a=e(n);a&&(a.clear(),n.value&&a.addEach(t))}},reversed:function(e){return function(t,n){var a=e(n);a&&a.swap(0,a.length,t.reversed())}},everyBlock:function(e,t,n){return function(a,s){if(a){var r=e(s),i=n(s);r.forEach(function(e){t(i,Scope.nest(s,e))})}}}}};