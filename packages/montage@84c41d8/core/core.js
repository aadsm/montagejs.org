function getAttributeProperties(e,n){var s=UNDERSCORE+n+ATTRIBUTE_PROPERTIES;return e.hasOwnProperty(s)?e[s]:Object.defineProperty(e,s,{enumerable:!1,configurable:!1,writable:!0,value:Object.create(getAttributeProperties(Object.getPrototypeOf(e),n))})[s]}require("collections/shim"),require("core/shim/object"),require("core/shim/array"),require("core/shim/string"),require("core/extras/object"),require("core/extras/date"),require("core/extras/element"),require("core/extras/function"),require("core/extras/regexp"),require("core/extras/string");var ATTRIBUTE_PROPERTIES="AttributeProperties",UNDERSCORE="_",PROTO="__proto__",VALUE="value",ENUMERABLE="enumerable",DISTINCT="distinct",SERIALIZABLE="serializable",MODIFY="modify",Array_prototype=Array.prototype,Object_prototype=Object.prototype,CONSTRUCTOR_COMPATIBILITY=!0,Montage=exports.Montage=function Montage(){};Montage.deprecate=function(e,n,s,a){var t=function(){var t=Error.stackTraceLimit;return Error.stackTraceLimit=2,"undefined"!=typeof console&&"function"==typeof console.warn&&(a?console.warn(s+" is deprecated, use "+a+" instead.",Error("").stack):console.warn(s,Error("").stack)),Error.stackTraceLimit=t,n.apply(e?e:this,arguments)};return t.deprecatedFunction=n,t},Montage.callDeprecatedFunction=function(e,n,s,a){var t,o,i=Error.stackTraceLimit;return Error.stackTraceLimit=2,"undefined"!=typeof console&&"function"==typeof console.warn&&(t=Montage.getInfoForObject(e).objectName,a?console.warn(s+" is deprecated, use "+a+" instead.",t):console.warn(s,t)),Error.stackTraceLimit=i,o=Array_prototype.slice.call(arguments,4),n.apply(e?e:this,o)};var PROTO_IS_SUPPORTED={}.__proto__===Object.prototype,PROTO_PROPERTIES_BLACKLIST={_montage_metadata:1,__state__:1},FUNCTION_PROPERTIES=Object.getOwnPropertyNames(Function);if(Object.defineProperty(Montage,"specialize",{value:function(e,n){var s,a,t,o,i,r,l,p=this,c=this.specialize===void 0;if(e=e||Object.empty,n=n||Object.empty,s=e.constructor&&e.constructor.value?e.constructor.value:e.didCreate&&e.didCreate.value?Montage.deprecate(null,e.didCreate.value,"didCreate","constructor"):function(){return p.apply(this,arguments)||this},PROTO_IS_SUPPORTED)s.__proto__=p;else{t=Object.getOwnPropertyNames(p);for(var r=0;t.length>r;r++)o=t[r],PROTO_PROPERTIES_BLACKLIST.hasOwnProperty(o)||(i=Object.getOwnPropertyDescriptor(s,o),(!i||i.configurable)&&Montage.defineProperty(s,o,Object.getOwnPropertyDescriptor(p,o)));s.__constructorProto__=p,Montage.defineProperty(s,"isPrototypeOf",{value:function(e){for(;null!==e;){if(Object.getPrototypeOf(e)===this)return!0;e=Object.getPrototypeOf(e)}return!1},enumerable:!1})}if(a=Object.create(this.prototype),c){for(t=Object.getOwnPropertyNames(Montage),r=0;t.length>r;r++)o=t[r],i=Object.getOwnPropertyDescriptor(s,o),(!i||i.configurable)&&Montage.defineProperty(s,o,Object.getOwnPropertyDescriptor(Montage,o));for(t=Object.getOwnPropertyNames(Montage.prototype),r=0;t.length>r;r++)o=t[r],i=Object.getOwnPropertyDescriptor(s,o),(!i||i.configurable)&&Montage.defineProperty(a,o,Object.getOwnPropertyDescriptor(Montage.prototype,o))}if(Montage.defineProperties(a,e),CONSTRUCTOR_COMPATIBILITY){l=function(e,n,s){function a(){return this===n&&console.warn("Deprecated - "+Montage.getInfoForObject(n).objectName+"."+s+" should be moved to constructorProperties"),e.apply(this,arguments)}return a.deprecatedFunction=e,a};for(o in e)FUNCTION_PROPERTIES.has(o)?delete e[o]:(i=e[o],i.value&&"function"==typeof i.value&&!i.value.__isConstructor__?i.value=l(i.value,s,o):(i.get&&(i.get=l(i.get,s,o)),i.set&&(i.set=l(i.set,s,o))));Montage.defineProperties(s,e),Montage.defineProperty(s,"create",{value:function(){return new s},enumerable:!1}),a.hasOwnProperty("didCreate")||Montage.defineProperty(a,"didCreate",{value:s,enumerable:!1}),s.hasOwnProperty("didCreate")||Montage.defineProperty(s,"didCreate",{value:s,enumerable:!1})}return Montage.defineProperties(s,n),Montage.defineProperty(s,"__isConstructor__",{value:!0,enumerable:!1}),s.prototype=a,Montage.defineProperty(a,"constructor",{value:s,enumerable:!1}),s},writable:!0,configurable:!0,enumerable:!1}),!PROTO_IS_SUPPORTED){var originalGetPrototypeOf=Object.getPrototypeOf;Object.getPrototypeOf=function(e){return"function"==typeof e&&e.__constructorProto__?e.__constructorProto__:originalGetPrototypeOf.apply(Object,arguments)}}Object.defineProperty(Montage,"create",{configurable:!0,value:function(e,n){if(void 0!==e&&"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object prototype may only be an Object or null, not '"+e+"'");if(e=e===void 0?this:e,"function"==typeof e)return n?e.specialize(n):new e;var s=Object.create(e);return n&&Montage.defineProperties(s,n),s}});var extendedPropertyAttributes=[SERIALIZABLE];extendedPropertyAttributes.forEach(function(e){Object.defineProperty(Object.prototype,UNDERSCORE+e+ATTRIBUTE_PROPERTIES,{enumerable:!1,configurable:!1,writable:!0,value:{}})}),Object.defineProperty(Montage,"defineProperty",{value:function(e,n,s){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object must be an object, not '"+e+"'");var a=VALUE in s;if(DISTINCT in s&&!a)throw"Cannot use distinct attribute on non-value property '"+n+"'";if(PROTO in s)s.__proto__=a?"function"==typeof s.value?_defaultFunctionValueProperty:_defaultObjectValueProperty:_defaultAccessorProperty;else{var t;t=a?"function"==typeof s.value?_defaultFunctionValueProperty:_defaultObjectValueProperty:_defaultAccessorProperty;for(var o in t)o in s||(s[o]=t[o])}return s.hasOwnProperty(ENUMERABLE)||n.charAt(0)!==UNDERSCORE||(s.enumerable=!1),s.hasOwnProperty(SERIALIZABLE)||(s.enumerable?s.get&&!s.set?s.serializable=!1:s.writable===!1&&(s.serializable=!1):s.serializable=!1),SERIALIZABLE in s&&(getAttributeProperties(e,SERIALIZABLE)[n]=s.serializable),s.distinct!==!0||"object"!=typeof s.value?Object.defineProperty(e,n,s):(function(e,n,s,a){var t=function(e,n,s){Object.defineProperty(e,n,{enumerable:!1,configurable:!0,writable:!0,value:s})};s.constructor===Object&&Object.getPrototypeOf(s)===Object_prototype?0!==Object.keys(s).length?Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[n];if(!e){var a;e={};for(a in s)e[a]=s[a];this.hasOwnProperty(n)?this[n]=e:t(this,n,e)}return e},set:function(e){this.hasOwnProperty(n)?this[n]=e:t(this,n,e)}}):Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[n];return e||(e={},this.hasOwnProperty(n)?this[n]=e:t(this,n,e)),e},set:function(e){this.hasOwnProperty(n)?this[n]=e:t(this,n,e)}}):(s.__proto__||Object.getPrototypeOf(s))===Array_prototype?0!==s.length?Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[n];if(!e){var a,o;for(e=[],a=0;(o=s[a])!==void 0;a++)e[a]=o;this.hasOwnProperty(n)?this[n]=e:t(this,n,e)}return e},set:function(e){this.hasOwnProperty(n)?this[n]=e:t(this,n,e)}}):Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[n];return e||(e=[],this.hasOwnProperty(n)?this[n]=e:t(this,n,e)),e},set:function(e){this.hasOwnProperty(n)?this[n]=e:t(this,n,e)}}):s.constructor.prototype===Object.getPrototypeOf(s)?Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[n];if(!e){var a;e=new s.constructor;for(a in s)e[a]=s[a];this.hasOwnProperty(n)?this[n]=e:t(this,n,e)}return e},set:function(e){this.hasOwnProperty(n)?this[n]=e:t(this,n,e)}}):Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[n];return e||(e=Object.create(s.__proto__||Object.getPrototypeOf(s)),this.hasOwnProperty(n)?this[n]=e:t(this,n,e)),e},set:function(e){this.hasOwnProperty(n)?this[n]=e:t(this,n,e)}})}(n,UNDERSCORE+n,s.value,e),void 0)}}),Object.defineProperty(Montage,"defineProperties",{value:function(e,n){if("object"!=typeof n||null===n)throw new TypeError("Properties must be an object, not '"+n+"'");for(var s in n)"_bindingDescriptors"!==s&&this.defineProperty(e,s,n[s]);return e}});var _defaultAccessorProperty={enumerable:!0,configurable:!0,serializable:!0},_defaultObjectValueProperty={writable:!0,enumerable:!0,configurable:!0,serializable:"reference"},_defaultFunctionValueProperty={writable:!0,enumerable:!1,configurable:!0,serializable:!1};Montage.defineProperty(Montage,"didCreate",{value:Function.noop});var getSuper=function(e,n){for(var s,a,t,o,i,r,l,p;l===void 0&&null!==e;){for(s=Object.getOwnPropertyNames(e),o=0,i=s.length,o;i>o;o++)if(a=s[o],t=Object.getOwnPropertyDescriptor(e,a),null!=(r=t.value)){if(r===n||r.deprecatedFunction&&r.deprecatedFunction===n){p=Object.getPropertyDescriptor(Object.getPrototypeOf(e),a),l=p?p.value:null;break}}else if(null!=(r=t.get)){if(r===n||r.deprecatedFunction&&r.deprecatedFunction===n){p=Object.getPropertyDescriptor(Object.getPrototypeOf(e),a),l=p?p.get:null;break}}else if(null!=(r=t.set)&&(r===n||r.deprecatedFunction&&r.deprecatedFunction===n)){p=Object.getPropertyDescriptor(Object.getPrototypeOf(e),a),l=p?p.set:null;break}e=Object.getPrototypeOf(e)}return l},superImplementation=function(){var e=getSuper(this,superImplementation.caller);return"function"==typeof e?getSuper(this,superImplementation.caller).bind(this):Function.noop};Montage.defineProperty(Montage,"super",{get:superImplementation}),Montage.defineProperty(Montage.prototype,"super",{get:superImplementation}),Montage.defineProperty(Montage,"getSerializablePropertyNames",{value:function(e){var n=[],s=e._serializableAttributeProperties;if(s)for(var a in s)s[a]&&n.push(a);return n}}),Montage.defineProperty(Montage,"getPropertyAttribute",{value:function(e,n,s){var a=UNDERSCORE+s+ATTRIBUTE_PROPERTIES,t=e[a];return t?t[n]:void 0}}),Montage.defineProperty(Montage,"getPropertyAttributes",{value:function(e,n){var s={},a=UNDERSCORE+n+ATTRIBUTE_PROPERTIES,t=e[a];if(t){for(var o in t)s[o]=t[o];return s}}});var _instanceMetadataDescriptor={isInstance:{value:!0}},_functionInstanceMetadataDescriptor={objectName:{value:"Function"},isInstance:{value:!0}};Montage.defineProperty(Montage,"getInfoForObject",{value:function(e){var n,s;if(hasOwnProperty.call(e,"_montage_metadata"))return e._montage_metadata;n=e._montage_metadata||e.constructor&&e.constructor._montage_metadata||null,s=e.constructor===Function?_functionInstanceMetadataDescriptor:_instanceMetadataDescriptor;try{return Object.defineProperty(e,"_montage_metadata",{enumerable:!1,writable:!0,value:Object.create(n,s)})._montage_metadata}catch(a){return e._montage_metadata=Object.create(n,s)}}});var UUID=require("core/uuid");"undefined"!=typeof window&&(window.uuid=UUID.generate());var hasOwnProperty=Object.prototype.hasOwnProperty,uuidGetGenerator=function(){var e=UUID.generate(),n=Montage.getInfoForObject(this);try{null!==n&&n.isInstance===!1?(this._uuid=e,Object.defineProperty(this,"uuid",{get:function(){return this.hasOwnProperty("uuid")?this._uuid:uuidGetGenerator.call(this)}})):(n.isInstance&&Object.defineProperty(this,"uuid",{configurable:!0,enumerable:!1,writable:!1,value:e}),!(this instanceof Element)&&n.isInstance&&VALUE in(Object.getOwnPropertyDescriptor(this,"uuid")||{})&&PROTO in this||(this._uuid=e))}catch(s){this._uuid=e}return e},defaultUuidGet=function defaultUuidGet(){return hasOwnProperty.call(this,"_uuid")?this._uuid:uuidGetGenerator.call(this)};Object.defineProperty(Object.prototype,"_uuid",{enumerable:!1,value:null,writable:!0}),Object.defineProperty(Object.prototype,"uuid",{configurable:!0,get:defaultUuidGet,set:function(){}}),Montage.defineProperty(Montage,"identifier",{value:null,serializable:!0}),Montage.defineProperty(Montage.prototype,"identifier",{value:null,serializable:!0}),Montage.defineProperty(Montage.prototype,"equals",{value:function(e){return e?this===e||this.uuid===e.uuid:!1}}),Montage.defineProperty(Montage,"equals",{value:Montage.prototype.equals}),Montage.defineProperty(Montage.prototype,"callDelegateMethod",{value:function(e){var n,s,a=this.delegate;return"string"==typeof this.identifier&&(n=this.identifier+e.toCapitalized(),a&&"function"==typeof(s=a[n]))?(Array_prototype.shift.call(arguments),s.apply(a,arguments)):a&&"function"==typeof(s=a[e])?(Array_prototype.shift.call(arguments),s.apply(a,arguments)):void 0}});var PropertyChanges=require("collections/listen/property-changes");Object.addEach(Montage,PropertyChanges.prototype),Object.addEach(Montage.prototype,PropertyChanges.prototype),require("core/bindings"),require("core/paths"),require("core/serialization/bindings"),exports._blueprintModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=Montage.getInfoForObject(this),n=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(n,"_blueprintModuleId")||!n._blueprintModuleId){e=Montage.getInfoForObject(n);var s=e.moduleId,a=s.lastIndexOf("/"),t=s.lastIndexOf(".");a=-1===a?0:a+1,t=-1===t?s.length:t,t=a>t?s.length:t,Montage.defineProperty(n,"_blueprintModuleId",{enumerable:!1,value:s.slice(0,t)+".meta"})}return n._blueprintModuleId}},exports._blueprintDescriptor={serializable:!1,enumerable:!1,get:function(){var e=Montage.getInfoForObject(this),n=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(n,"_blueprint")||!n._blueprint){var s=n.blueprintModuleId;if(""===s)throw new TypeError("Blueprint moduleId undefined for the module '"+JSON.stringify(n)+"'");exports._blueprintDescriptor.BlueprintModulePromise||(exports._blueprintDescriptor.BlueprintModulePromise=require.async("core/meta/blueprint").get("Blueprint")),Montage.defineProperty(n,"_blueprint",{enumerable:!1,value:exports._blueprintDescriptor.BlueprintModulePromise.then(function(e){var a=Montage.getInfoForObject(n);return e.getBlueprintWithModuleId(s,a.require).fail(function(){var a=e.createDefaultBlueprintForObject(n);return a.blueprintInstanceModuleId=s,a})})})}return n._blueprint},set:function(e){var n,s=Montage.getInfoForObject(this),a=s&&!s.isInstance?this:this.constructor;if(null===e)n=null;else{if("function"==typeof e.then)throw new TypeError("Object blueprint should not be a promise '"+JSON.stringify(e)+"'");e.blueprintInstanceModuleId=a.blueprintModuleId,n=require("core/promise").Promise.resolve(e)}Montage.defineProperty(a,"_blueprint",{enumerable:!1,value:n})}};