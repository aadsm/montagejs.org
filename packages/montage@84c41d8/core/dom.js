var Point=require("core/geometry/point").Point,NodePrototype=Node.prototype,ElementPrototype=Element.prototype;Object.defineProperty(ElementPrototype,"set",{value:function(e,n,t){var s,a,o,i,r,l=e.indexOf(".",t);t=t||0,a=e.substring(t,-1===l?e.length:l),-1===l?this.setAttribute(a,n):(o=e.lastIndexOf("."),"style"===a?(i=e.substring(l+1,e.length),this.style[i]=n):"classList"===a?(r=e.substring(l+1,e.length),n?this.classList.add(r):this.classList.remove(r)):(s=this.get(e.substring(0,o)))&&(s[e.substring(o+1,e.length)]=n))},enumerable:!1}),NodePrototype.get=function(e){return this.getAttribute(e)||this[e]},Object.getPrototypeOf(document).addRule=function(e,n){var t,s;if(null==(t=document.styleSheets[0])){var a=document.createElement("style");a.type="text/css",document.head.appendChild(a),t=document.styleSheets[0]}else s=document.getRule(e,t);s||t.insertRule(e+" "+n,t.cssRules.length)},Object.getPrototypeOf(document).getRule=function(e,n){var t;if(n.cssRules)for(var s=0;t=n.cssRules[s];s++){if(t.name&&t.name===e)return t;if(t.selectorText===e)return t}},"undefined"!=typeof Element&&function(){var e="classList";if(!Element.prototype.hasOwnProperty(e)){var n=/^\s+|\s+$/g,t=function(e,n){e.setAttribute("class",n.join(" "))},s=function(e,n){if(""===n)throw"SYNTAX_ERR";if(/\s/.test(n))throw"INVALID_CHARACTER_ERR";return e.indexOf(n)},a=function(){var e=this,a=e.getAttribute("class")||"";return a=a.replace(n,"").split(/\s+/),{length:a.length,item:function(e){return a[e]||null},contains:function(e){return-1!==s(a,e)},add:function(n){-1===s(a,n)&&(a.push(n),this.length=a.length,t(e,a))},remove:function(n){var o=s(a,n);-1!==o&&(a.splice(o,1),this.length=a.length,t(e,a))},toggle:function(e){-1===s(a,e)?this.add(e):this.remove(e)},toString:function(){return e.getAttribute("class")||""}}};Object.defineProperty?Object.defineProperty(Element.prototype,e,{get:a,enumerable:!0}):Object.prototype.__defineGetter__&&Element.prototype.__defineGetter__(e,a)}}(),NodePrototype.parentOf=function(e){for(;(e=e.parentNode)&&e!==this;);return e?!0:!1};var _offsetForElement=function(e){var n,t,s,a,o=e.ownerDocument;if(e&&o){if(t=o.documentElement,s=o.body,a=o.defaultView,e!==s){if(n=e.getBoundingClientRect(),t.parentOf(e)){var i=t.clientTop||s.clientTop||0,r=t.clientLeft||s.clientLeft||0,l=a.pageYOffset||t.scrollTop||s.scrollTop,p=a.pageXOffset||t.scrollLeft||s.scrollLeft,c=n.top+l-i,u=n.left+p-r;return{top:c,left:u}}return{top:n.top,left:n.left}}return{top:s.offsetTop,left:s.offsetLeft}}return null},_webKitPoint=null;try{_webKitPoint=new WebKitPoint(0,0)}catch(e){}var webkitImplementation=function(){exports.convertPointFromNodeToPage=function(e,n){return n?(_webKitPoint.x=n.x,_webKitPoint.y=n.y):(_webKitPoint.x=0,_webKitPoint.y=0),n=webkitConvertPointFromNodeToPage(e,_webKitPoint),n?(new Point).init(n.x,n.y):null},exports.convertPointFromPageToNode=function(e,n){return n?(_webKitPoint.x=n.x,_webKitPoint.y=n.y):(_webKitPoint.x=0,_webKitPoint.y=0),n=webkitConvertPointFromPageToNode(e,_webKitPoint),n?(new Point).init(n.x,n.y):null}},shimImplementation=function(){exports.convertPointFromNodeToPage=function(e,n){if(!e||e.x!==void 0)return null;var t;return(t=_offsetForElement(e))?(new Point).init((n?n.x:0)+t.left,(n?n.y:0)+t.top):(new Point).init(n?n.x:0,n?n.y:0)},exports.convertPointFromPageToNode=function(e,n){if(!e||e.x!==void 0)return null;var t;return(t=_offsetForElement(e))?(new Point).init((n?n.x:0)-t.left,(n?n.y:0)-t.top):(new Point).init(n?n.x:0,n?n.y:0)}};_webKitPoint?webkitImplementation():shimImplementation();