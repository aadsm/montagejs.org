montageDefine("84c41d8","core/meta/blueprint-reference",{dependencies:["montage","core/promise","core/meta/blueprint","core/meta/binder","core/meta/remote-reference","core/meta/binder-reference","core/logger"],factory:function(e,n){"use strict";e("montage").Montage;var t=e("core/promise").Promise,s=e("core/meta/blueprint"),a=e("core/meta/binder"),o=e("core/meta/remote-reference").RemoteReference,i=e("core/meta/binder-reference").BinderReference;e("core/logger").logger("blueprint"),n.BlueprintReference=o.specialize({constructor:{value:function(){this.super()}},identifier:{get:function(){return this._reference||(this._reference=this.referenceFromValue(this._value)),["blueprint",this._reference.blueprintName.toLowerCase(),"reference"].join("_")}},valueFromReference:{value:function(n,o){n.blueprintName;var r=n.blueprintModuleId,l=n.prototypeName,p=n.moduleId,c=n.binderReference,u=t.resolve(a.Binder.manager.defaultBinder);c&&(u=i.valueFromReference(c,e));var h=t.defer();return u.then(function(n){if(n){var t=n.blueprintForPrototype(l,p);if(t)h.resolve(t);else try{s.Blueprint.getBlueprintWithModuleId(r,o).then(function(e){e?(n.addBlueprint(e),h.resolve(e)):h.reject(Error("Error cannot find Blueprint "+r))},h.reject)}catch(a){h.reject(Error("Error cannot find Blueprint "+r))}}else try{h=s.Blueprint.getBlueprintWithModuleId(r,e)}catch(a){h.reject(Error("Error cannot find Blueprint "+r))}}),h.promise}},referenceFromValue:{value:function(e){var n={};return n.blueprintName=e.name,n.blueprintModuleId=e.blueprintModuleId,n.prototypeName=e.prototypeName,n.moduleId=e.moduleId,e.binder&&!e.binder.isDefault&&(n.binderReference=i.referenceFromValue(e.binder)),n}}})}});