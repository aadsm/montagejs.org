var Montage=require("montage").Montage,TranslateComposer=require("composer/translate-composer").TranslateComposer,defaultEventManager=require("core/event/event-manager").defaultEventManager,Point=require("core/geometry/point").Point,convertPointFromPageToNode=require("core/dom").convertPointFromPageToNode,FlowTranslateComposer=exports.FlowTranslateComposer=TranslateComposer.specialize({constructor:{value:function(){this.super()}},_scrollingMode:{value:"linear"},scrollingMode:{get:function(){return this._scrollingMode},set:function(e){switch(e){case"linear":case"drag":this._scrollingMode=e}}},_linearScrollingVector:{value:[-300,0]},linearScrollingVector:{get:function(){return this._linearScrollingVector},set:function(e){this._linearScrollingVector=e}},_startPageX:{value:null},_startPageY:{value:null},_pageX:{value:null},_pageY:{value:null},_pointerStartX:{value:null},_pointerStartY:{value:null},_contentOffsetX:{value:null},_contentOffsetY:{value:null},_start:{value:function(e,t){TranslateComposer._start.apply(this,arguments);var n=window.getComputedStyle(this._element,null),s=this.convertCssPixelsPropertyStringToNumber(n.getPropertyValue("border-left-width")),a=this.convertCssPixelsPropertyStringToNumber(n.getPropertyValue("border-top-width")),i=this.convertCssPixelsPropertyStringToNumber(n.getPropertyValue("padding-left")),r=this.convertCssPixelsPropertyStringToNumber(n.getPropertyValue("padding-top")),o=convertPointFromPageToNode(this._element,(new Point).init(e,t));this._pointerStartX=this._pointerX=o.x-s-i,this._pointerStartY=this._pointerY=o.y-a-r,this._contentOffsetX=this._startPageX-this._pointerStartX,this._contentOffsetY=this._startPageY-this._pointerStartY,this._computePointedElement(),this._startPageX=this._pageX=e,this._startPageY=this._pageY=t,this._startScroll=this._scroll,this._previousScrollDelta=0,this._scrollEnd=null}},_analyzeMovement:{value:function(e){var t,n,s,a=e.velocity;a&&(t=a.speed,t>=this.startTranslateSpeed?this._stealPointer():(n=this.startPageX-e.pageX,s=this.startPageY-e.pageY,n*n+s*s>this.startTranslateRadius*this.startTranslateRadius&&this._stealPointer()))}},_dispatchTranslateStart:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateStart",!0,!0,null),e.scroll=this._scroll,this.dispatchEvent(e)}},_dispatchTranslateEnd:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateEnd",!0,!0,null),e.scroll=this._scroll,this.dispatchEvent(e)}},_dispatchTranslate:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translate",!0,!0,null),e.scroll=this._scroll,this.dispatchEvent(e)}},_move:{value:function(e,t){this._isFirstMove&&(this._dispatchTranslateStart(),this._isFirstMove=!1),this._pageX=e,this._pageY=t,"drag"===this._scrollingMode?(this._pointerX=e-this._contentOffsetX,this._pointerY=t-this._contentOffsetY,this._updateDragScroll()):this._updateLinearScroll(),null!==this._closerIndex,this._shouldDispatchTranslate&&this._dispatchTranslate()}},_end:{value:function(e){this.startTime=Date.now(),this.endX=this.startX=this._pageX,this.endY=this.startY=this._pageY,this._hasMomentum&&(e.velocity.speed>40||this.translateStrideX||this.translateStrideY)?(this.momentumX="vertical"!=this._axis?e.velocity.x*this._pointerSpeedMultiplier*(this._invertXAxis?1:-1):0,this.momentumY="horizontal"!=this._axis?e.velocity.y*this._pointerSpeedMultiplier*(this._invertYAxis?1:-1):0,this.endX=this.startX+this.momentumX*this.__momentumDuration/2e3,this.endY=this.startY+this.momentumY*this.__momentumDuration/2e3,this.startStrideXTime=null,this.startStrideYTime=null,this.animateMomentum=!0):this.animateMomentum=!1,this.animateMomentum?this._animationInterval():this._isFirstMove||this._dispatchTranslateEnd(),this._releaseInterest()}},handleMousewheel:{value:function(){}},_scroll:{value:0},scroll:{get:function(){return this._scroll},set:function(e){null!==this.minScroll&&this.minScroll>e&&(e=this.minScroll),null!==this.maxScroll&&e>this.maxScroll&&(e=this.maxScroll),this._scroll=e}},minScroll:{value:null},maxScroll:{value:null},_flow:{value:null},flow:{get:function(){return this._flow},set:function(e){this._flow=e,this.component=e}},_updateScroll:{value:function(){"linear"===this._scrollingMode?this._updateLinearScroll():this._updateDragScroll()}},_updateLinearScroll:{value:function(){var e=500/this._flow._height,t=(this._pageX-this._startPageX)*this._linearScrollingVector[0]*e,n=(this._pageY-this._startPageY)*this._linearScrollingVector[1]*e,s=this._linearScrollingVector[0]*this._linearScrollingVector[0]+this._linearScrollingVector[1]*this._linearScrollingVector[1],a=(t+n)/s;this.scroll+=a-this._previousScrollDelta,this._previousScrollDelta=a}},_updateDragScroll:{value:function(){var e=(this._pointerX-this._pointerStartX)*this._lineVectorX,t=(this._pointerY-this._pointerStartY)*this._lineVectorY,n=this._lineVectorX*this._lineVectorX+this._lineVectorY*this._lineVectorY,s=(e+t)/n;this.scroll+=s-this._previousScrollDelta,this._previousScrollDelta=s;var a,i,r,o,l,p,c,u,h,d,m,g,f,v,b,y,w,_,E,x,T=this._flow,j=T._cameraPosition,k=T._splinePaths,M=k.length,P=this._closerIndex%M,S=this.flow._splinePaths[P],C=Math.floor(this._closerIndex/M)-this._scroll+this._flow._paths[P].headOffset,D=null,O=null,A=0,B=.5*this._element.clientWidth,I=.5*this._element.clientHeight,e=B-this._pointerX,t=I-this._pointerY,z=T.cameraTargetPoint[0]-j[0],N=T.cameraTargetPoint[1]-j[1],L=T.cameraTargetPoint[2]-j[2],q=-Math.atan2(z,L),R=this._pointerIntersectionPosition;m=L*Math.cos(q)-z*Math.sin(q),g=-Math.atan2(N,m),y=Math.sin(q),w=Math.cos(q),_=Math.sin(g),E=Math.cos(g),v=I/Math.tan(.008726646259972*T.cameraFov),x=0,c=1e100;do d=S._convertSplineTimeToBezierIndexTime(C+x),null!==d&&(a=S.getPositionAtIndexTime(d),rotation=k[P].getRotationAtIndexTime(d),f=this._rotateXYZ(R,rotation),i=(j[2]-a[2]-f[2])*y-(a[0]-j[0]+f[0])*w,r=a[1]-j[1]+f[1],o=(a[2]-j[2]+f[2])*w-(a[0]-j[0]+f[0])*y,l=o*_+r*E,p=o*E-r*_,b=v/p,i=e+i*b,r=t+l*b,h=i*i+r*r,c>h&&(c=h,D=x)),x-=.025;while(x>-6);D+.025>0&&(D=-.025),x=D+.025,c=1e100;do d=S._convertSplineTimeToBezierIndexTime(C+x),null!==d&&(a=S.getPositionAtIndexTime(d),rotation=k[P].getRotationAtIndexTime(d),f=this._rotateXYZ(R,rotation),i=(j[2]-a[2]-f[2])*y-(a[0]-j[0]+f[0])*w,r=a[1]-j[1]+f[1],o=(a[2]-j[2]+f[2])*w-(a[0]-j[0]+f[0])*y,l=o*_+r*E,p=o*E-r*_,b=v/p,i=e+i*b,r=t+l*b,h=i*i+r*r,c>h&&(c=h,D=x)),x-=2e-4;while(x>D-.05);x=0,u=1e100;do d=S._convertSplineTimeToBezierIndexTime(C+x),null!==d&&(a=S.getPositionAtIndexTime(d),rotation=k[P].getRotationAtIndexTime(d),f=this._rotateXYZ(R,rotation),i=(j[2]-a[2]-f[2])*y-(a[0]-j[0]+f[0])*w,r=a[1]-j[1]+f[1],o=(a[2]-j[2]+f[2])*w-(a[0]-j[0]+f[0])*y,l=o*_+r*E,p=o*E-r*_,b=v/p,i=e+i*b,r=t+l*b,h=i*i+r*r,u>h&&(u=h,O=x)),x+=.025;while(6>x);0>O-.025&&(O=.025),x=O-.025,u=1e100;do d=S._convertSplineTimeToBezierIndexTime(C+x),null!==d&&(a=S.getPositionAtIndexTime(d),rotation=k[P].getRotationAtIndexTime(d),f=this._rotateXYZ(R,rotation),i=(j[2]-a[2]-f[2])*y-(a[0]-j[0]+f[0])*w,r=a[1]-j[1]+f[1],o=(a[2]-j[2]+f[2])*w-(a[0]-j[0]+f[0])*y,l=o*_+r*E,p=o*E-r*_,b=v/p,i=e+i*b,r=t+l*b,h=i*i+r*r,u>h&&(u=h,O=x)),x+=2e-4;while(O+.05>x);D?A=O?O*O>D*D?D:O:D:O&&(A=O),A>0?.05>=A&&(this.scroll=this._scroll-A):A>=-.05&&(this.scroll=this._scroll-A)}},frame:{value:function(){this.isAnimating&&this._animationInterval()}},convertCssPixelsPropertyStringToNumber:{value:function(e){return"string"==typeof e?"px"===e.substr(-2)?1*e.substr(0,e.length-2):0:0}},_rayRectangleIntersection:{value:function(e,t,n,s){var a,i,r,o,l,p=e[1]*s[2]-e[2]*s[1],c=e[2]*s[0]-e[0]*s[2],u=e[0]*s[1]-e[1]*s[0],h=n[0]*p+n[1]*c+n[2]*u,d=1e-10,m=!1;return-d>h?(a=-t[0]*p-t[1]*c-t[2]*u,0>a&&a>h&&(r=n[1]*t[2]-n[2]*t[1],o=n[2]*t[0]-n[0]*t[2],l=n[0]*t[1]-n[1]*t[0],i=e[0]*r+e[1]*o+e[2]*l,0>i&&i>h&&(m=(s[0]*r+s[1]*o+s[2]*l)/h,0>m&&(m=!1)))):h>d&&(a=-t[0]*p-t[1]*c-t[2]*u,a>0&&h>a&&(r=n[1]*t[2]-n[2]*t[1],o=n[2]*t[0]-n[0]*t[2],l=n[0]*t[1]-n[1]*t[0],i=e[0]*r+e[1]*o+e[2]*l,i>0&&h>i&&(m=(s[0]*r+s[1]*o+s[2]*l)/h,0>m&&(m=!1)))),m}},_rayRectangleIntersectionPosition:{enumerable:!1,value:function(e,t,n,s){var a,i,r,o,l,p=e[1]*s[2]-e[2]*s[1],c=e[2]*s[0]-e[0]*s[2],u=e[0]*s[1]-e[1]*s[0],h=n[0]*p+n[1]*c+n[2]*u,d=this._flow._boundingBoxSize;return a=-t[0]*p-t[1]*c-t[2]*u,r=n[1]*t[2]-n[2]*t[1],o=n[2]*t[0]-n[0]*t[2],l=n[0]*t[1]-n[1]*t[0],i=e[0]*r+e[1]*o+e[2]*l,[a*d[0]/h-.5*d[0],i*d[1]/h-.5*d[1],0]}},_rotateXYZ:{enumerable:!1,value:function(e,t){var n,s,a,i,r=Math.cos(t[0]),o=Math.sin(t[0]),l=Math.cos(t[1]),p=Math.sin(t[1]),c=Math.cos(t[2]),u=Math.sin(t[2]);return s=r*e[1]-o*e[2],a=o*e[1]+r*e[2],i=l*e[0]+p*a,a=-p*e[0]+l*a,n=c*i-u*s,s=u*i+c*s,[n,s,a]}},_pointerIntersectionPosition:{enumerable:!1,value:null},_closerIndex:{enumerable:!1,value:null},_computePointedElement:{value:function(){var e=this._flow._splinePaths,t=e.length;if(t){var n,s,a,i,r,o,l,p,c,u,h,d,m,g=this._flow,f=g.cameraTargetPoint[0]-g.cameraPosition[0],v=g.cameraTargetPoint[2]-g.cameraPosition[2],b=Math.atan2(f,v),y=v*Math.cos(-b)-f*Math.sin(-b),w=Math.atan2(g.cameraTargetPoint[1]-g.cameraPosition[1],y),_=.5*this._element.clientWidth-this._pointerX,E=this._pointerY-.5*this._element.clientHeight,x=.5*this._element.offsetHeight/Math.tan(g.cameraFov*g._doublePI*(1/720)),T=[],j=g._visibleIndexes,k=j.length,M=null,P=1e100;for(s=x*Math.cos(w)-E*Math.sin(w),E=x*Math.sin(w)+E*Math.cos(w),n=s*Math.cos(b)-_*Math.sin(b),_=s*Math.sin(b)+_*Math.cos(b),h=[_,E,n],m=0;e.length>m;m++)T[m]=e[m].transform([1,0,0,0,0,1,0,0,0,0,1,0,-g.cameraPosition[0],-g.cameraPosition[1],-g.cameraPosition[2],1]);for(m=0;k>m;m++)d=this._flow.offset(j[m]),a=d.pathIndex,i=d.slideTime,o=T[a]._convertSplineTimeToBezierIndexTime(i),null!==o&&(pos=T[a].getPositionAtIndexTime(o),l=e[a].getRotationAtIndexTime(o),c=this._rotateXYZ([g.boundingBoxSize[0],0,0],l),u=this._rotateXYZ([0,g.boundingBoxSize[1],0],l),p=[pos[0]-.5*(c[0]+u[0]),pos[1]-.5*(c[1]+u[1]),pos[2]-.5*(c[2]+u[2])],(r=this._rayRectangleIntersection(h,p,c,u))&&P>r&&(P=r,M=j[m],this._pointerIntersectionPosition=this._rayRectangleIntersectionPosition(h,p,c,u)));this._closerIndex=M}}},test:{enumerable:!1,value:function(){var e,t,n,s,a,i,r,o,l,p,c=this._flow,u=this._bezierValue,h=c.cameraTargetPoint[0]-c.cameraPosition[0],d=c.cameraTargetPoint[1]-c.cameraPosition[1],m=c.cameraTargetPoint[2]-c.cameraPosition[2],g=Math.atan2(h,m),f=this._pointerX,v=this._pointerY;if(e=m*Math.cos(-g)-h*Math.sin(-g),t=Math.atan2(d,e),s=.5*this._element.clientWidth-f,a=v-.5*this._element.clientHeight,p=i=.5*this._element.offsetHeight/Math.tan(c.cameraFov*c._doublePI*(1/720)),l=i*Math.cos(t)-a*Math.sin(t),o=i*Math.sin(t)+a*Math.cos(t),r=s,i=l*Math.cos(g)-r*Math.sin(g),s=l*Math.sin(g)+r*Math.cos(g),a=o,this.t=n=this._raycastBezierTubes(c._cameraPosition[0],c._cameraPosition[1],c._cameraPosition[2],this._computeRotationValuesToXAxis(s,a,i)),null!==n[0]){var s,a,i,r,o,l,b,y,w,_,E,x=[c._splinePaths[n[0]]._knots[n[1]][0]-c._cameraPosition[0],c._splinePaths[n[0]]._knots[n[1]][1]-c._cameraPosition[1],c._splinePaths[n[0]]._knots[n[1]][2]-c._cameraPosition[2],c._splinePaths[n[0]]._nextHandlers[n[1]][0]-c._cameraPosition[0],c._splinePaths[n[0]]._nextHandlers[n[1]][1]-c._cameraPosition[1],c._splinePaths[n[0]]._nextHandlers[n[1]][2]-c._cameraPosition[2],c._splinePaths[n[0]]._previousHandlers[n[1]+1][0]-c._cameraPosition[0],c._splinePaths[n[0]]._previousHandlers[n[1]+1][1]-c._cameraPosition[1],c._splinePaths[n[0]]._previousHandlers[n[1]+1][2]-c._cameraPosition[2],c._splinePaths[n[0]]._knots[n[1]+1][0]-c._cameraPosition[0],c._splinePaths[n[0]]._knots[n[1]+1][1]-c._cameraPosition[1],c._splinePaths[n[0]]._knots[n[1]+1][2]-c._cameraPosition[2]],T=[];for(E=0;12>E;E+=3)T[0]=x[E+2]*Math.sin(-g)+x[E]*Math.cos(-g),T[1]=x[E+1],T[2]=x[E+2]*Math.cos(-g)-x[E]*Math.sin(-g),x[E]=T[0],x[E+1]=T[2]*Math.sin(-t)+T[1]*Math.cos(-t),x[E+2]=T[2]*Math.cos(-t)-T[1]*Math.sin(-t);i=u(x[2],x[5],x[8],x[11],n[2]),l=u(x[2],x[5],x[8],x[11],n[2]+1e-8),s=u(x[0],x[3],x[6],x[9],n[2])/i,r=u(x[0],x[3],x[6],x[9],n[2]+1e-8)/l,b=(r-s)*p/1e-8,a=u(x[1],x[4],x[7],x[10],n[2])/i,o=u(x[1],x[4],x[7],x[10],n[2]+1e-8)/l,dy=(o-a)*p/1e-8,y=Math.sqrt(b*b+dy*dy),w=Math.atan2(dy,b),_=c._splinePaths[n[0]]._densities[n[1]]*(1-n[2])+c._splinePaths[n[0]]._densities[n[1]+1]*n[2],this._lineVectorX=Math.cos(-w)*y/_,this._lineVectorY=Math.sin(-w)*y/_}}},_lineVectorX:{enumerable:!1,value:80*Math.cos(Math.PI-.6)},_lineVectorY:{enumerable:!1,value:80*Math.sin(Math.PI-.6)},_startX:{enumerable:!1,value:0},_startY:{enumerable:!1,value:0},_currentX:{enumerable:!1,value:0},_currentY:{enumerable:!1,value:0},_previousScrollDelta:{enumerable:!1,value:0},_startScroll:{enumerable:!1,value:0},_bezierValue:{enumerable:!1,value:function(e,t,n,s,a){var i=1-a;return e*i*i*i+3*t*i*i*a+3*n*i*a*a+s*a*a*a}},_computeRotationValuesToXAxis:{enumerable:!1,value:function(e,t,n){var s,a,i,r,o;return 1e-100>e*e&&(e=1e-50),s=e*e+t*t,a=Math.sqrt(s),i=1/a,o=e*i,r=-t*i,i=1/Math.sqrt(s+n*n),[r,o,-n*i,a*i]}},_infinite:{enumerable:!1,value:1e100},_sphereIntersection:{enumerable:!1,value:function(e,t){var n,s,a,i=e[0]*t[1]-e[1]*t[0],r=e[0]*t[0]+e[1]*t[1],o=i*t[2]+e[2]*t[3],l=e[3]*e[3];return l>=r*r+o*o?(n=i*t[3]-e[2]*t[2],s=Math.sqrt(l-r*r-o*o),a=n-s,0>a?0>n+s?this._infinite:0:a):this._infinite}},_bezierTubeBoundingSphere:{enumerable:!1,value:function(e,t){var n,s,a,i,r,o=e[0],l=e[1],p=e[2],c=e[0],u=e[1],h=e[2];return r=e[3],o>r?o=r:r>c&&(c=r),r=e[4],l>r?l=r:r>u&&(u=r),r=e[5],p>r?p=r:r>h&&(h=r),r=e[6],o>r?o=r:r>c&&(c=r),r=e[7],l>r?l=r:r>u&&(u=r),r=e[8],p>r?p=r:r>h&&(h=r),r=e[9],o>r?o=r:r>c&&(c=r),r=e[10],l>r?l=r:r>u&&(u=r),r=e[11],p>r?p=r:r>h&&(h=r),n=.5*(c-o),s=.5*(u-l),a=.5*(h-p),i=Math.sqrt(n*n+s*s+a*a)+t,[o+n,l+s,p+a,i]}},_raycastBezierTubes:{enumerable:!1,value:function(e,t,n,s){var a,i,r,o,l,p,c,u,h,d,m,g,f,v,b,y,w,_,E,x,T,j,k,M,P,S,C,D,O=[],A=this._infinite,B=null,I=0,z=null,N=0,L=this._flow._splinePaths;for(D=0;L.length>D;D++)for(C=0;L[D]._knots.length-1>C;C++)O[N]=[L[D]._knots[C][0]-e,L[D]._knots[C][1]-t,L[D]._knots[C][2]-n,L[D]._nextHandlers[C][0]-e,L[D]._nextHandlers[C][1]-t,L[D]._nextHandlers[C][2]-n,L[D]._previousHandlers[C+1][0]-e,L[D]._previousHandlers[C+1][1]-t,L[D]._previousHandlers[C+1][2]-n,L[D]._knots[C+1][0]-e,L[D]._knots[C+1][1]-t,L[D]._knots[C+1][2]-n,0,1048576,C,D],N++;for(C=N-1;C>=0;)c=O[C],u=.5*(c[0]+c[3]),h=.5*(c[3]+c[6]),d=.5*(c[6]+c[9]),v=.5*(c[1]+c[4]),b=.5*(c[4]+c[7]),y=.5*(c[7]+c[10]),x=.5*(c[2]+c[5]),T=.5*(c[5]+c[8]),j=.5*(c[8]+c[11]),m=.5*(u+h),g=.5*(h+d),f=.5*(m+g),w=.5*(v+b),_=.5*(b+y),E=.5*(w+_),k=.5*(x+T),M=.5*(T+j),P=.5*(k+M),S=c[13]>>1,r=[c[0],c[1],c[2],u,v,x,m,w,k,f,E,P,c[12],S,c[14],c[15]],a=this._bezierTubeBoundingSphere(r,this._flow._elementsBoundingSphereRadius),o=[f,E,P,g,_,M,d,y,j,c[9],c[10],c[11],c[12]+S,S,c[14],c[15]],i=this._bezierTubeBoundingSphere(o,this._flow._elementsBoundingSphereRadius),l=this._sphereIntersection(a,s),p=this._sphereIntersection(i,s),A>l?A>p?p>l?S?(O[C++]=o,O[C]=r):(A=l-1e-5,I=c[12],B=c[14],z=c[15],C--):S?(O[C++]=r,O[C]=o):(A=p-1e-5,I=c[12],B=c[14],z=c[15],C--):S?O[C]=r:(A=l-1e-5,I=c[12],B=c[14],z=c[15],C--):A>p?S?O[C]=o:(A=p-1e-5,I=c[12],B=c[14],z=c[15],C--):C--;return[z,B,I*(1/1048576)]}},_translateStride:{enumerable:!1,value:null},translateStride:{serializable:!0,get:function(){return this._translateStride},set:function(e){this._translateStride=e,this.translateStrideX=e}},startStrideTime:{enumerable:!1,value:null},_scrollEnd:{enumerable:!1,value:null},_scrollStart:{enumerable:!1,value:null},_hasMomentum:{enumerable:!1,value:!0},_animationInterval:{enumerable:!1,value:function(){var e,t,n,s,a,i,r=Date.now(),o=!1;a=this.minScroll,i=this.maxScroll,this.minScroll=null,this.maxScroll=null,null===this._scrollEnd&&(this._scrollStart=this.scroll,this._pageX=this.endX,this._pageY=this.endY,this._updateScroll(),this._scrollEnd=this.scroll,this._pageX=this.startX,this._pageY=this.startY,this._updateScroll()),this.animateMomentum?(e=r-this.startTime,this.__momentumDuration>e?(this._pageX=this.startX+(this.momentumX+this.momentumX*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this._pageY=this.startY+(this.momentumY+this.momentumY*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this._updateScroll(),this.translateStrideX&&null===this.startStrideXTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.scroll-this._scrollEnd)<.75*this.translateStrideX)&&(this.startStrideXTime=r,this._strideStartScroll=this._scroll)):this.animateMomentum=!1):null===this.startStrideXTime&&(this.startStrideXTime=this.startTime,this._strideStartScroll=this._scrollStart),s=this.scroll,this.startStrideXTime&&r-this.startStrideXTime>0&&(n=Math.round(this._scrollEnd/this.translateStrideX),r-this.startStrideXTime<this.translateStrideDuration?(e=this._bezierTValue((r-this.startStrideXTime)/this.translateStrideDuration,.275,0,.275,1),t=(r-this.startStrideXTime)/this.translateStrideDuration,s=s*(1-t)+(n*this.translateStrideX*e+this._strideStartScroll*(1-e))*t,o=!0):s=n*this.translateStrideX),this.minScroll=a,this.maxScroll=i,a>s&&(s=a,this.animateMomentum=!1,o=!1),s>i&&(s=i,this.animateMomentum=!1,o=!1),this.scroll=s,this.isAnimating=this.animateMomentum||o,this.isAnimating?this.needsFrame=!0:(this._dispatchTranslateEnd(),this._scrollEnd=null)}}});