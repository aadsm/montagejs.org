var common=require("../common"),assert=require("assert"),stream=require("../../readable");(function(){var e=1e3,t=new stream.Readable;t._read=function(n){n=Math.min(e,n),e-=n,t.push(new Buffer(n))};var n;t.unpipe=function(e){n=e,stream.Readable.prototype.unpipe.call(this,e)};var a=new stream.Writable;a._write=function(e,t,n){n()},t.pipe(a);var s=null;a.on("error",function(e){s=e});var r;a.on("unpipe",function(e){r=e});var i=Error("This stream turned into bacon.");a.emit("error",i),assert.strictEqual(s,i),assert.strictEqual(r,t),assert.strictEqual(n,a)})(),function(){var e=1e3,t=new stream.Readable;t._read=function(n){n=Math.min(e,n),e-=n,t.push(new Buffer(n))};var n;t.unpipe=function(e){n=e,stream.Readable.prototype.unpipe.call(this,e)};var a=new stream.Writable;a._write=function(e,t,n){n()},t.pipe(a);var s;a.on("unpipe",function(e){s=e});var r=Error("This stream turned into bacon."),i=null;try{a.emit("error",r)}catch(o){i=o}assert.strictEqual(i,r),assert.strictEqual(s,t),assert.strictEqual(n,a)}();