montageDefine("545ead3","test/simple/test-stream2-push",{dependencies:["../common.js","../../readable","assert","util","events"],factory:function(e){function t(){console.error("readStart"),d=!0}function n(){console.error("readStop"),d=!1,process.nextTick(function(){var e=i.read();null!==e&&m.write(e)})}function a(){c(d),u.emit("data",v),c(d),u.emit("data",v),c(d),u.emit("data",v),c(d),u.emit("data",v),c(!d),5>b++?setTimeout(a,10):r()}function s(){console.error("finish"),c.deepEqual(f,g),console.log("ok")}function r(){u.emit("end"),c(!d),m.end(i.read()),setTimeout(function(){c(h)})}e("../common.js");var i=e("../../readable"),o=i.Readable,l=i.Writable,c=e("assert");e("util");var p=e("events").EventEmitter,i=new o({highWaterMark:16,encoding:"utf8"}),u=new p;i._read=function(){console.error("stream._read"),t()};var h=!1;i.on("end",function(){h=!0}),u.on("data",function(e){var t=i.push(e);console.error("data",i._readableState.length),t||n()}),u.on("end",function(){i.push(null)});var d=!1,m=new l({decodeStrings:!1}),f=[],g=["asdfgasdfgasdfgasdfg","asdfgasdfgasdfgasdfg","asdfgasdfgasdfgasdfg","asdfgasdfgasdfgasdfg","asdfgasdfgasdfgasdfg","asdfgasdfgasdfgasdfg"];m._write=function(e,t,n){console.error("WRITE %s",e),f.push(e),process.nextTick(n)},m.on("finish",s);var v="asdfg",b=0;t(),a()}});