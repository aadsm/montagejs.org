function test1(){function e(){for(var e;null!==(e=t.read());)s.push(e+"")}var t=new Readable,n=new Buffer(5);n.fill("x");var a=5;t._read=function(){switch(a--){case 0:return t.push(null);case 1:return t.push(n);case 2:return setTimeout(t.read.bind(t,0),10),t.push(new Buffer(0));case 3:return setTimeout(t.read.bind(t,0),10),process.nextTick(function(){return t.push(new Buffer(0))});case 4:return setTimeout(t.read.bind(t,0),10),setTimeout(function(){return t.push(new Buffer(0))});case 5:return setTimeout(function(){return t.push(n)});default:throw Error("unreachable")}};var s=[];t.on("readable",e),t.on("end",function(){s.push("EOF")}),e(),process.on("exit",function(){assert.deepEqual(s,["xxxxx","xxxxx","EOF"]),console.log("ok")})}function test2(){function e(){for(var e;null!==(e=t.read());)a.push(e+"")}var t=new Readable({encoding:"base64"}),n=5;t._read=function(){return n--?t.push(new Buffer("x")):t.push(null)};var a=[];t.on("readable",e),t.on("end",function(){a.push("EOF")}),e(),process.on("exit",function(){assert.deepEqual(a,["eHh4","eHg=","EOF"]),console.log("ok")})}var common=require("../common"),assert=require("assert"),Readable=require("../../readable").Readable;test1(),/^v0\.[0-8]\./.test(process.version)||test2();