montageDefine("545ead3","test/simple/test-stream2-readable-non-empty-end",{dependencies:["assert","../common.js","../../lib/_stream_readable"],factory:function(e){function t(){throw Error("this should not happen!")}function n(){l.removeListener("end",t);var e=!1;process.on("exit",function(){a(e,"end should be emitted by now")}),l.on("end",function(){e=!0});var n=l.read();a(n),a.equal(n.length,1),n=l.read(),a.equal(n,null)}var a=e("assert");e("../common.js");for(var s=e("../../lib/_stream_readable"),r=0,i=Array(10),o=1;10>=o;o++)i[o-1]=new Buffer(o),r+=o;var l=new s,c=0;l._read=function(){var e=i[c++];setTimeout(function(){l.push(e)})},l.on("end",t);var p=0;l.on("readable",function(){var e=r-p-1,t=l.read(e);t&&(p+=t.length,console.error("br=%d len=%d",p,r),setTimeout(n)),l.read(0)}),l.read(0)}});