montageDefine("545ead3","zlib",{dependencies:["./lib/_stream_transform.js","util","assert"],factory:function(e,t){function n(e,t,n){function a(){for(var t;null!==(t=e.read());)i.push(t),o+=t.length;e.once("readable",a)}function s(t){e.removeListener("end",r),e.removeListener("readable",a),n(t)}function r(){var e=Buffer.concat(i,o);i=[],n(null,e)}var i=[],o=0;e.on("error",s),e.on("end",r),e.end(t),a()}function a(e){return this instanceof a?(p.call(this,e,h.DEFLATE),void 0):new a(e)}function s(e){return this instanceof s?(p.call(this,e,h.INFLATE),void 0):new s(e)}function r(e){return this instanceof r?(p.call(this,e,h.GZIP),void 0):new r(e)}function i(e){return this instanceof i?(p.call(this,e,h.GUNZIP),void 0):new i(e)}function o(e){return this instanceof o?(p.call(this,e,h.DEFLATERAW),void 0):new o(e)}function l(e){return this instanceof l?(p.call(this,e,h.INFLATERAW),void 0):new l(e)}function c(e){return this instanceof c?(p.call(this,e,h.UNZIP),void 0):new c(e)}function p(e,n){if(this._opts=e=e||{},this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,u.call(this,e),this._readableState.chunkSize=null,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!Buffer.isBuffer(e.dictionary))throw Error("Invalid dictionary: it should be a Buffer instance");this._binding=new h.Zlib(n);var a=this;this._hadError=!1,this._binding.onerror=function(e,n){a._binding=null,a._hadError=!0;var s=Error(e);s.errno=n,s.code=t.codes[n],a.emit("error",s)},this._binding.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,e.level||t.Z_DEFAULT_COMPRESSION,e.memLevel||t.Z_DEFAULT_MEMLEVEL,e.strategy||t.Z_DEFAULT_STRATEGY,e.dictionary),this._buffer=new Buffer(this._chunkSize),this._offset=0,this._closed=!1,this.once("end",this.close)}var u=e("./lib/_stream_transform.js"),h=process.binding("zlib"),d=e("util"),m=e("assert").ok;h.Z_MIN_WINDOWBITS=8,h.Z_MAX_WINDOWBITS=15,h.Z_DEFAULT_WINDOWBITS=15,h.Z_MIN_CHUNK=64,h.Z_MAX_CHUNK=1/0,h.Z_DEFAULT_CHUNK=16384,h.Z_MIN_MEMLEVEL=1,h.Z_MAX_MEMLEVEL=9,h.Z_DEFAULT_MEMLEVEL=8,h.Z_MIN_LEVEL=-1,h.Z_MAX_LEVEL=9,h.Z_DEFAULT_LEVEL=h.Z_DEFAULT_COMPRESSION,Object.keys(h).forEach(function(e){e.match(/^Z/)&&(t[e]=h[e])}),t.codes={Z_OK:h.Z_OK,Z_STREAM_END:h.Z_STREAM_END,Z_NEED_DICT:h.Z_NEED_DICT,Z_ERRNO:h.Z_ERRNO,Z_STREAM_ERROR:h.Z_STREAM_ERROR,Z_DATA_ERROR:h.Z_DATA_ERROR,Z_MEM_ERROR:h.Z_MEM_ERROR,Z_BUF_ERROR:h.Z_BUF_ERROR,Z_VERSION_ERROR:h.Z_VERSION_ERROR},Object.keys(t.codes).forEach(function(e){t.codes[t.codes[e]]=e}),t.Deflate=a,t.Inflate=s,t.Gzip=r,t.Gunzip=i,t.DeflateRaw=o,t.InflateRaw=l,t.Unzip=c,t.createDeflate=function(e){return new a(e)},t.createInflate=function(e){return new s(e)},t.createDeflateRaw=function(e){return new o(e)},t.createInflateRaw=function(e){return new l(e)},t.createGzip=function(e){return new r(e)},t.createGunzip=function(e){return new i(e)},t.createUnzip=function(e){return new c(e)},t.deflate=function(e,t){n(new a,e,t)},t.gzip=function(e,t){n(new r,e,t)},t.deflateRaw=function(e,t){n(new o,e,t)},t.unzip=function(e,t){n(new c,e,t)},t.inflate=function(e,t){n(new s,e,t)},t.gunzip=function(e,t){n(new i,e,t)},t.inflateRaw=function(e,t){n(new l,e,t)},d.inherits(p,u),p.prototype.reset=function(){return this._binding.reset()},p.prototype._flush=function(e,t){var n=this._readableState,a=this;this._transform(null,e,function(e){return e?t(e):(n.length&&n.length<n.lowWaterMark&&!n.ended&&n.needReadable&&a.emit("readable"),t(),void 0)})},p.prototype.flush=function(e){var t=this._writableState,n=this._transformState;if(t.writing){t.needDrain=!0;var a=this;return this.once("drain",function(){a._flush(n.output,e)}),void 0}this._flush(n.output,e||function(){})},p.prototype.close=function(e){if(e&&process.nextTick(e),!this._closed){this._closed=!0,this._binding.close();var t=this;process.nextTick(function(){t.emit("close")})}},p.prototype._transform=function(e,t,n){function a(r,i){if(!d._hadError){var o=c-i;if(m(o>=0,"have should not go down"),o>0){var u=d._buffer.slice(d._offset,d._offset+o);d._offset+=o,t(u)}if((0===i||d._offset>=d._chunkSize)&&(c=d._chunkSize,d._offset=0,d._buffer=new Buffer(d._chunkSize)),0===i){p+=l-r,l=r;var h=d._binding.write(s,e,p,l,d._buffer,d._offset,d._chunkSize);return h.callback=a,h.buffer=e,void 0}n()}}var s,r=this._writableState,i=r.ending||r.ended,o=i&&(!e||r.length===e.length);if(null!==e&&!Buffer.isBuffer(e))return n(Error("invalid input"));s=o?h.Z_FINISH:null===e?h.Z_FULL_FLUSH:h.Z_NO_FLUSH;var l=e&&e.length,c=this._chunkSize-this._offset,p=0,u=this._binding.write(s,e,p,l,this._buffer,this._offset,c);u.buffer=e,u.callback=a;var d=this},d.inherits(a,p),d.inherits(s,p),d.inherits(r,p),d.inherits(i,p),d.inherits(o,p),d.inherits(l,p),d.inherits(c,p)}});